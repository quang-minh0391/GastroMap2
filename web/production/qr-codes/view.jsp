<%@page contentType="text/html" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@include file="../../common/header.jsp" %>

<div class="mb-4">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2 class="fw-bold">üì± Chi ti·∫øt M√£ QR</h2>
            <p class="text-muted">Th√¥ng tin chi ti·∫øt v·ªÅ m√£ QR v√† l√¥ s·∫£n xu·∫•t</p>
        </div>
        <a href="${pageContext.request.contextPath}/traceability?action=result&qrId=${qrCode.id}" 
           class="btn btn-success">üîç Xem Truy xu·∫•t</a>
    </div>
</div>

<div class="row">
    <div class="col-md-5">
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-body text-center py-4">
                <!-- QR Code Image - Generated by ZXing -->
                <div class="qr-code-container mb-3 p-3 bg-white d-inline-block border rounded">
                    <img src="${pageContext.request.contextPath}/qr-image?id=${qrCode.id}" 
                         alt="QR Code: ${qrCode.qrValue}"
                         width="250" height="250"
                         class="img-fluid"
                         id="qrCodeImage"
                         style="image-rendering: pixelated;">
                </div>
                <hr>
                <h5 class="text-success fw-bold mb-2">${qrCode.qrValue}</h5>
                <div class="mt-2">
                    <c:choose>
                        <c:when test="${qrCode.status == 'CREATED'}">
                            <span class="badge bg-success fs-6">ƒê√£ t·∫°o</span>
                        </c:when>
                        <c:when test="${qrCode.status == 'PRINTED'}">
                            <span class="badge bg-info fs-6">ƒê√£ in</span>
                        </c:when>
                        <c:when test="${qrCode.status == 'USED'}">
                            <span class="badge bg-warning fs-6">ƒê√£ d√πng</span>
                        </c:when>
                        <c:otherwise>
                            <span class="badge bg-secondary fs-6">${qrCode.status}</span>
                        </c:otherwise>
                    </c:choose>
                </div>
                <div class="text-muted mt-2">
                    <small>Ng√†y t·∫°o: <fmt:formatDate value="${qrCode.createdAt}" pattern="dd/MM/yyyy HH:mm"/></small>
                </div>
                <div class="mt-3 d-flex gap-2 justify-content-center">
                    <button class="btn btn-outline-primary" onclick="window.print()">
                        <i class="bi bi-printer me-1"></i> In m√£ QR
                    </button>
                    <a href="${pageContext.request.contextPath}/qr-image?id=${qrCode.id}" 
                       download="QR_${qrCode.qrValue}.png"
                       class="btn btn-outline-success">
                        <i class="bi bi-download me-1"></i> T·∫£i xu·ªëng
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Scan Instructions -->
        <div class="card shadow-sm border-0 bg-light">
            <div class="card-body">
                <h6 class="fw-bold mb-2"><i class="bi bi-phone me-2"></i>H∆∞·ªõng d·∫´n qu√©t</h6>
                <ol class="small mb-0 ps-3">
                    <li>M·ªü ·ª©ng d·ª•ng Camera ho·∫∑c qu√©t QR tr√™n ƒëi·ªán tho·∫°i</li>
                    <li>H∆∞·ªõng camera v√†o m√£ QR ·ªü tr√™n</li>
                    <li>Nh·∫•n v√†o link hi·ªán ra ƒë·ªÉ xem th√¥ng tin truy xu·∫•t</li>
                </ol>
            </div>
        </div>
    </div>
    <div class="col-md-7">
        <h5 class="fw-bold mb-3">üìã Th√¥ng tin li√™n k·∫øt</h5>
        
        <c:if test="${not empty batch}">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0 fw-bold">üì¶ L√¥ s·∫£n xu·∫•t</h6>
                </div>
                <div class="card-body">
                    <p class="mb-1">
                        <strong>M√£ l√¥:</strong> 
                        <a href="${pageContext.request.contextPath}/production-batches?action=view&id=${batch.id}">
                            ${batch.batchCode}
                        </a>
                    </p>
                    <p class="mb-1"><strong>S·∫£n l∆∞·ª£ng:</strong> ${batch.totalQuantity} ${batch.unit}</p>
                    <p class="mb-1"><strong>Ng√†y thu ho·∫°ch:</strong> <fmt:formatDate value="${batch.harvestDate}" pattern="dd/MM/yyyy"/></p>
                    <c:if test="${not empty batch.expiryDate}">
                        <p class="mb-0"><strong>H·∫°n s·ª≠ d·ª•ng:</strong> <fmt:formatDate value="${batch.expiryDate}" pattern="dd/MM/yyyy"/></p>
                    </c:if>
                </div>
            </div>
        </c:if>

        <c:if test="${not empty product}">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0 fw-bold">üåæ N√¥ng s·∫£n</h6>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>T√™n:</strong> ${product.name}</p>
                    <p class="mb-0"><strong>ƒê∆°n v·ªã:</strong> ${product.unit}</p>
                </div>
            </div>
        </c:if>

        <c:if test="${not empty member}">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-header bg-light">
                    <h6 class="mb-0 fw-bold">üë§ Th√†nh vi√™n s·∫£n xu·∫•t</h6>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>H·ªç t√™n:</strong> ${member.full_name}</p>
                    <c:if test="${not empty member.phone}">
                        <p class="mb-1"><strong>ƒêi·ªán tho·∫°i:</strong> ${member.phone}</p>
                    </c:if>
                    <c:if test="${not empty member.address}">
                        <p class="mb-0"><strong>ƒê·ªãa ch·ªâ:</strong> ${member.address}</p>
                    </c:if>
                </div>
            </div>
        </c:if>
    </div>
</div>

<div class="mt-3">
    <a href="${pageContext.request.contextPath}/qr-codes" class="btn btn-secondary">
        ‚Üê Quay l·∫°i danh s√°ch
    </a>
</div>

<%@include file="../../common/footer.jsp" %>
